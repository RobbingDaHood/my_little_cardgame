version: 1

# -------------------------------------------------
# Reusable definitions
# -------------------------------------------------

shared:

  trusted_repos: &trusted_repos
    path_in:
      - /home/cometlab/cometlab-setup/devenv/repos/*
      - /home/dapeters/Projects/*

# -------------------------------------------------
# Policies
# -------------------------------------------------

policies:

  # Allow file operations in trusted repos
  - name: trusted-repo-files
    allow:
      - file.read
      - file.write
      - file.create
      - file.delete
      - file.move
    where: *trusted_repos

  # Allow dev commands in trusted repos
  - name: trusted-repo-commands
    allow:
      - shell.exec
    commands:
      - pytest *
      - cargo test *
      - make *
      - just *
      - ruff *
      - black *
      - grep *
      - find *
    where: *trusted_repos

  # Allow safe git operations
  - name: trusted-repo-git
    allow:
      - shell.exec
    commands:
      - git status
      - git diff *
      - git add *
      - git commit *
      - git checkout *
      - git switch *
      - git restore *
      - git branch *
      - git merge *
      - gh pr view *
      - gh auth status
      - gh repo view *
      - gh repo list *
      - gh pr view *
      - gh pr list *
      - gh run view *
      - gh run list *
      - gh workflow view *
      - gh workflow list *
      - gh release view *
      - gh release list *
      - gh browse *
    deny:
      - git push origin development
      - git push origin main
      - git push origin master
    where: *trusted_repos

  # Everything else requires approval
  - name: fallback
    require_approval: true

